# SQLIFIX
Structured query language (SQL) is the language to interact with relational databases. The interaction is performed using different SQL statements. The SQL injection (SQLI) attack exploits inputs of SQL statements. The attacks are usually accomplished by contaminating SQL queries with special characters or keywords. The attacker tries to alter the logic of the statement to read confidential data, to modify database records, and to corrupt/delete data. They, sometimes, take control of administrative operations or issue malicious commands to the operating system.

SQLI attacks are among the oldest and most deadly threats to web application since the dawn of web databases. Even some reputed applications of large organizations fall victim to this. In August 2014, computer security company Hold Security found that SQL injections can be successfully used to disclose confidential information from almost 420,000 websites \cite{Poeter14}. Seals \cite{taraInfoSec} shows that SQLI was behind stealing the personal details of 156,959 customers from British Telecommunications company in 2015. Even in 2020, an SQLI attack was used to access information from the server of Link, a start-up founded on Stanford campus \cite{StandfordDaily}. At the first decade of this century, quite a few incidents of credit card information theft and millions of dollars of fraudulent purchases caused by SQLI were reported.\rafid{should cite source here}

Automatic Program Repair (APR) is an increasingly popular research area to provide automatic fix suggestions for different types of errors/bugs. These techniques suggest some candidate changes which may repair a given fault. These techniques are expected to reduce significant tedious effort and time for bug fixing by the developers in future. Recent improvements in advanced machine learning, especially deep learning, and the availability of large numbers of patches enable learning-based repair in addition to previous rule based approaches. In this work, our objective is to develop an APR tool to mitigate SQLI vulnerabilities with high quality.

The common suggestions to prevent SQLI include parameterizing queries instead of directly embedding user input in them, escaping the characters that have a special meaning in SQL, and checking pattern of the parameters. However, developers often fail to comply with such guidelines, especially when there is tight deadline. For new/inexperienced developers, this is not unexpected. To expose any unattended vulnerability, there are quite a few SQL injection detection tools. On the other hand, to the best of our knowledge, very few works have been done to help the developers fix these vulnerabilities quickly.

%% Anindya: Add from predicting bug fix time. Also, criticize works in literature more.

The early approaches \cite{HalfondASE05, HalfondFSE06, Halfond06aclassification, Su2006} have proposed solutions for mitigating SQLI attacks. However, none of these solutions address the actual SQLI vulnerabilities that exist in the source code. Only a few existing works\cite{DysartISSRE08, ThomasIST09} attempted to generate fix suggestions for SQLI by removing vulnerabilities from source code. These approaches propose change in source code to remove SQLI vulnerabilities whereas previous mitigating approaches would try to fortify against the SQLI attacks. Reference \cite{ThomasIST09} proposed to remove SQLI vulnerabilities from SQL statements by replacing them with secure prepared statements. However, their rule based approach is language-specific and not adaptive to future changes in the language. Their work on Java fails to cover advanced programming constructs such as Lambda expression, inline methods, etc. Also, they cannot fix multi-line queries (concatenated together). In this paper, we propose an unsupervised learning based approach that overcomes these limitations. We have developed solution for Java and PhP using this language-agnostic approach. A very important requirement from APR techniques is natural change that sustains readability of changed code \cite{bader2019getafix}. Our solution provides good result in this consideration as well.

Our approach, which is highly inspired by Bader et. al. \cite{bader2019getafix}, is based on a hierarchical clustering where the nodes that are higher in the hierarchy are more abstract than the lower ones. It creates a dendrogram of edit patterns (the pattern we need to apply to the tainted model to fix vulnerability) where only the leaves contain concrete edits. When we get a new vulnerable code, we start matching the AST (Abstract Syntax Tree) of the given code with the ``before\_tree'' (elaborated in Section - \ref{sec:methodology}) of an edit pattern starting from the root of the cluster tree. We go down the dendrogram until we find a match for our AST and suggest the fix pattern if we find a match. \anindya{Write 2 lines about the training and test set generated from real world projects. Give anonymous git link where the code and data are released.}

Our approach generates solutions for 67.52\% cases for Java, tested with 7 real world Java projects. We compare our approach with the comparable approach \cite{Thomas09} which generates correct solution for 23.67\% cases on the same test set. We extend our approach for PHP which generates 41.33\% correct solutions on an independent test set. The result was also validated by industry experts.
